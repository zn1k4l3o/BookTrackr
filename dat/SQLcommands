DROP TABLE ALL_USERS;
DROP TABLE BOOK;
DROP TABLE BORROWED;
DROP TABLE BORROWED_HISTORY;
DROP TABLE ITEM;
DROP TABLE LIBRARY;
DROP TABLE MOVIE;
DROP TABLE RESERVED;
DROP TABLE RESERVED_HISTORY;
DROP TABLE GENRE;

CREATE TABLE ALL_USERS (
    ID LONG GENERATED ALWAYS AS IDENTITY,
    USERNAME VARCHAR(255) UNIQUE NOT NULL,
    PASSWORD VARCHAR(255) NOT NULL,
    NAME VARCHAR(255) NOT NULL,
    LASTNAME VARCHAR(255) NOT NULL,
    LIBRARY_ID LONG NOT NULL,
    PRIMARY KEY (ID),
    IS_WORKER BOOLEAN NOT NULL DEFAULT FALSE
);

CREATE TABLE ITEM (
    ID LONG GENERATED ALWAYS AS IDENTITY,
    TITLE VARCHAR(255) NOT NULL,
    RATING DECIMAL(10,2) NOT NULL,
    PRIMARY KEY (ID),
    CATEGORY VARCHAR(255) DEFAULT 'Book'
);

CREATE TABLE BOOK (
    ID LONG GENERATED ALWAYS AS IDENTITY,
    AUTHOR VARCHAR(255) NOT NULL,
    GENRE_ID LONG NOT NULL,
    PRIMARY KEY (ID),
    PUBLISHER VARCHAR(255) NOT NULL
);

CREATE TABLE MOVIE (
    ID LONG GENERATED ALWAYS AS IDENTITY,
    DESCRIPTION VARCHAR(511) NOT NULL,
    DIRECTOR VARCHAR(255) NOT NULL,
    FILM_RATING_SYSTEM VARCHAR(255) NOT NULL,
    PRIMARY KEY (ID),
    RELEASE_YEAR INT NOT NULL
);

CREATE TABLE LIBRARY (
    ID LONG GENERATED ALWAYS AS IDENTITY,
    NAME VARCHAR(255) NOT NULL,
    PRIMARY KEY (ID),
    PASSWORD VARCHAR(255) NOT NULL,
    WEB_ADDRESS VARCHAR(255) NOT NULL
);

CREATE TABLE BORROWED (
    ID LONG GENERATED ALWAYS AS IDENTITY,
    ITEM_ID LONG NOT NULL,
    USER_ID LONG NOT NULL,
    BORROW_DATE VARCHAR(255) NOT NULL,
    PRIMARY KEY (ID),
    RETURN_DATE VARCHAR(255) NOT NULL
);

CREATE TABLE BORROWED_HISTORY (
    ID LONG GENERATED ALWAYS AS IDENTITY,
    ITEM_ID LONG NOT NULL,
    USER_ID LONG NOT NULL,
    BORROW_DATE VARCHAR(255) NOT NULL,
    PRIMARY KEY (ID),
    RETURN_DATE VARCHAR(255) NOT NULL
);

CREATE TABLE RESERVED (
    ID LONG GENERATED ALWAYS AS IDENTITY,
    ITEM_ID LONG NOT NULL,
    USER_ID LONG NOT NULL,
    PRIMARY KEY (ID),
    RESERVED_DATE VARCHAR(255) NOT NULL
);

CREATE TABLE RESERVED_HISTORY (
    ID LONG GENERATED ALWAYS AS IDENTITY,
    ITEM_ID LONG NOT NULL,
    USER_ID LONG NOT NULL,
    PRIMARY KEY (ID),
    RESERVED_DATE VARCHAR(255) NOT NULL
);

CREATE TABLE LIBRARY_ITEM (
    LIBRARY_ID LONG NOT NULL,
    ITEM_ID LONG NOT NULL,
    PRIMARY KEY (LIBRARY_ID, ITEM_ID),
    FOREIGN KEY (LIBRARY_ID) REFERENCES LIBRARY(ID),
    FOREIGN KEY (ITEM_ID) REFERENCES ITEM(ID)
);

CREATE TABLE GENRE (
    ID LONG GENERATED ALWAYS AS IDENTITY,
    NAME VARCHAR(255) NOT NULL
);